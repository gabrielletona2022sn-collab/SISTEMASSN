<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SN PROYECTOS ‚Äî Smart Minutes</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        /* Palette - Moderna & Profesional */
        --bg-main: #f8fafc;
        --surface: #ffffff;
        --primary: #2563eb;
        --primary-hover: #1d4ed8;
        --secondary: #64748b;
        --text-main: #1e293b;
        --text-muted: #64748b;
        --accent: #0f172a;
        --border: #e2e8f0;
        --success: #10b981;
        --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --radius: 12px;
    }

    [data-theme="dark"] {
        --bg-main: #0f172a;
        --surface: #1e293b;
        --primary: #3b82f6;
        --primary-hover: #60a5fa;
        --text-main: #f1f5f9;
        --text-muted: #94a3b8;
        --border: #334155;
        --accent: #f8fafc;
    }

    body { 
        font-family: 'Inter', sans-serif; 
        background: var(--bg-main); 
        color: var(--text-main); 
        margin: 0; 
        padding: 0; 
        transition: all 0.3s ease;
        line-height: 1.5;
    }

    /* NAVBAR */
    header { 
        background: var(--surface); 
        color: var(--text-main); 
        padding: 1rem 2rem; 
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .logo { font-weight: 700; font-size: 1.2rem; letter-spacing: -0.5px; color: var(--primary); }

    /* LAYOUT M√ÅS MODERNO (Dos columnas en pantallas grandes) */
    .app-container { 
        max-width: 1200px; 
        margin: 2rem auto; 
        padding: 0 1.5rem;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }

    @media (max-width: 900px) { .app-container { grid-template-columns: 1fr; } }

    /* TARJETAS (CARDS) */
    .card {
        background: var(--surface);
        padding: 1.5rem;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        margin-bottom: 1.5rem;
    }

    h2 { 
        font-size: 0.875rem; 
        text-transform: uppercase; 
        letter-spacing: 0.05em; 
        color: var(--text-muted); 
        margin-bottom: 1.25rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* INPUTS ESTILO MINIMALISTA */
    .input-group { margin-bottom: 1rem; }
    
    label { 
        display: block; 
        font-size: 0.75rem; 
        font-weight: 600; 
        margin-bottom: 0.4rem; 
        color: var(--text-muted);
    }

    input, textarea { 
        width: 100%; 
        padding: 0.75rem; 
        border: 1px solid var(--border); 
        border-radius: 8px; 
        font-size: 0.95rem; 
        background: var(--bg-main); 
        color: var(--text-main); 
        box-sizing: border-box; 
        transition: border-color 0.2s;
        font-family: inherit;
    }

    input:focus, textarea:focus {
        outline: none;
        border-color: var(--primary);
        ring: 2px solid var(--primary);
    }
    
    textarea { height: 120px; }

    /* BOTONES */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        border: none;
        font-size: 0.9rem;
    }

    .btn-primary { background: var(--primary); color: white; width: 100%; }
    .btn-primary:hover { background: var(--primary-hover); }
    
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
    .btn-outline:hover { background: var(--bg-main); }

    .btn-success { background: var(--success); color: white; }

    /* BARRA DE PROGRESO */
    #progress-container { 
        position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: transparent; z-index: 1000; 
    }
    #progress-bar { height: 100%; background: var(--success); width: 0%; transition: width 0.4s ease; }

    /* RESULTADOS */
    #resultado, #acumulado {
        background: var(--bg-main);
        font-family: 'Courier New', Courier, monospace;
        font-size: 0.85rem;
        border-style: dashed;
    }

    #acumulado { height: 400px; }

    .btn-group-row { display: flex; gap: 10px; margin-top: 1rem; }

    .input-error { border: 2px solid #ef4444 !important; }

    .btn-mode {
        background: none; border: none; color: var(--text-main); cursor: pointer; font-size: 1.2rem;
    }

</style>
</head>
<body>

<div id="progress-container"><div id="progress-bar"></div></div>

<header>
    <div class="logo">SN PROYECTOS <span style="font-weight:300; opacity:0.6">| SmartMinutes</span></div>
    <button class="btn-mode" onclick="toggleTheme()" id="theme-btn">üåô</button>
</header>

<div class="app-container">
    
    <div class="input-section">
        <div class="card">
            <h2>üìç Contexto del Proyecto</h2>
            <div class="input-group">
                <label>NOMBRE DEL PROYECTO</label>
                <input id="proyecto" placeholder="Ej: Residenciales El Cortijo">
            </div>
            <div class="input-group">
                <label>UBICACI√ìN / DIRECCI√ìN</label>
                <input id="direccion" placeholder="Ej: Km 15.5 Carretera a El Salvador">
            </div>
        </div>

        <div class="card">
            <h2>üè† Detalles de la Propiedad</h2>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
                <div class="input-group">
                    <label>IDENTIFICADOR (PROPIEDAD)</label>
                    <input id="propiedad" placeholder="CASA A-1">
                </div>
                <div class="input-group">
                    <label>√ÅREA (M¬≤)</label>
                    <input id="area" placeholder="120.00">
                </div>
            </div>
            
            <div class="input-group">
                <label>DATOS DE EXCEL (ESTACIONES)</label>
                <textarea id="estacionesTexto" placeholder="Pegue aqu√≠ las 5 columnas de Excel..."></textarea>
            </div>

            <button class="btn btn-primary" onclick="generar()">
                <span>‚ö°</span> Generar Minuta
            </button>
        </div>

        <div class="card" style="border-style: dashed; background: transparent;">
            <h2>üìù Vista Previa</h2>
            <textarea id="resultado" readonly placeholder="El texto generado aparecer√° aqu√≠..."></textarea>
            <div style="margin-top: 1rem;">
                <button class="btn btn-success" style="width: 100%;" onclick="agregarAlDocumento()">
                    <span>‚ûï</span> Confirmar y Guardar en Bloque
                </button>
            </div>
        </div>
    </div>

    <div class="output-section">
        <div class="card">
            <h2>üìÇ Documento Final Acumulado</h2>
            <textarea id="acumulado" readonly placeholder="Aqu√≠ se est√°n guardando todas tus propiedades..."></textarea>
            
            <div class="btn-group-row">
                <button class="btn btn-outline" style="flex:1" onclick="copiarDocumento()">üìã Copiar</button>
                <button class="btn btn-outline" style="flex:1" onclick="exportarWord()">üíæ Word</button>
            </div>
            
            <button class="btn btn-outline" style="width:100%; margin-top:10px; color: #ef4444;" onclick="limpiarAcumulado()">
                üßπ Borrar Todo
            </button>
        </div>
        
        <div style="padding: 1rem; color: var(--text-muted); font-size: 0.8rem; text-align: center;">
            SN PROYECTOS ‚Äî Herramienta interna de gesti√≥n de minutas.
        </div>
    </div>
</div>

<script>
// --- MOTOR DE CONVERSI√ìN (SIN CAMBIOS) ---
function numeroALetras(num) {
    if (num === '' || num === null || num === undefined) return '';
    let str = num.toString().trim();
    if (str.includes('.')) {
        let partes = str.split('.');
        return numeroALetras(partes[0]) + ' punto ' + numeroALetras(partes[1]);
    }
    const unidades = ['cero','uno','dos','tres','cuatro','cinco','seis','siete','ocho','nueve'];
    const especiales = ['diez','once','doce','trece','caturce','quince'];
    const decenas = ['','diez','veinte','treinta','cuarenta','cincuenta','sesenta','setenta','ochenta','noventa'];
    const centenas = ['','ciento','doscientos','trescientos','cuatrocientos','quinientos','seiscientos','setecientos','ochocientos','novecientos'];
    let n = parseInt(str);
    if (isNaN(n)) return '';
    if (n < 10) return unidades[n];
    if (n >= 10 && n <= 15) return especiales[n - 10];
    if (n < 20) return 'dieci' + unidades[n - 10];
    if (n === 20) return 'veinte';
    if (n < 30) return 'veinti' + unidades[n - 20];
    if (n < 100) {
        let d = Math.floor(n / 10);
        let u = n % 10;
        return decenas[d] + (u ? ' y ' + unidades[u] : '');
    }
    if (n === 100) return 'cien';
    if (n < 1000) {
        let c = Math.floor(n / 100);
        let r = n % 100;
        return centenas[c] + (r ? ' ' + numeroALetras(r) : '');
    }
    if (n < 2000) return 'mil' + (n % 1000 ? ' ' + numeroALetras(n % 1000) : '');
    if (n < 1000000) {
        let m = Math.floor(n / 1000);
        let r = n % 1000;
        return numeroALetras(m) + ' mil' + (r ? ' ' + numeroALetras(r) : '');
    }
    return n.toString();
}

function convertirTexto(texto) {
    if (!texto) return '';
    return texto.replace(/\d+(?:-\d+)?(?:\.\d+)?/g, function(match) {
        if (match.includes('-')) {
            let partes = match.split('-');
            return numeroALetras(partes[0]) + ' guion ' + numeroALetras(partes[1]) + ' (' + match + ')';
        }
        return numeroALetras(match) + ' (' + match + ')';
    });
}

function generar(){
    if (!validarCampos()) return;
    let texto = `${convertirTexto(document.getElementById('propiedad').value).toUpperCase()}, ${convertirTexto(document.getElementById('proyecto').value).toUpperCase()} (QUE SI FORMAR√Å FINCA FILIAL) Finca nueva de naturaleza urbana, ubicada en ${convertirTexto(document.getElementById('direccion').value)}, con un √°rea total de ${numeroALetras(document.getElementById('area').value)} (${document.getElementById('area').value}) metros cuadrados, y con las siguientes estaciones, medidas y colindancias:\n`;
    let lineas = document.getElementById('estacionesTexto').value.trim().split(/\n+/);
    let errores = [];
    lineas.forEach((l, index) => {
        let p = l.split(/\t+/);
        let numLinea = index + 1;
        if(p.length < 5) { errores.push(`L√≠nea ${numLinea}: Faltan datos.`); return; }
        let est = p[0].trim(), po = p[1].trim(), dato = p[2].trim(), extra = p[3].trim(), col = convertirTexto(p.slice(4).join(' ').trim());
        let regexGMS = /(\d+)\s*¬∞\s*(\d+)\s*'\s*(\d+)/;
        texto += `\nDe la estaci√≥n ${numeroALetras(est)} (${est}) al punto observado ${numeroALetras(po)} (${po}): `;
        try {
            if(dato.toUpperCase().startsWith('D=')){
                let gms = dato.replace(/D=\s*/i, '').match(regexGMS);
                if(!gms) throw new Error();
                let L = extra.match(/L=\s*([0-9.]+)/i)[1];
                let R = extra.match(/R=\s*([0-9.]+)/i)[1];
                texto += `Con una delta de ${numeroALetras(gms[1])} grados (${gms[1]}¬∞), ${numeroALetras(gms[2])} minutos (${gms[2]}'), ${numeroALetras(gms[3])} segundos (${gms[3]}"), una longitud de curva de ${numeroALetras(L)} (${L}) metros y un radio de ${numeroALetras(R)} (${R}) metros, colindando con ${col}; `;
            } else {
                let gms = dato.match(regexGMS);
                if(!gms) throw new Error();
                texto += `Con un azimut de ${numeroALetras(gms[1])} grados (${gms[1]}¬∞), ${numeroALetras(gms[2])} minutos (${gms[2]}'), ${numeroALetras(gms[3])} segundos (${gms[3]}"), una distancia recta de ${numeroALetras(extra)} (${extra}) metros, colindando con ${col}; `;
            }
        } catch (e) { errores.push(`L√≠nea ${numLinea}: Error de formato.`); }
    });
    if (errores.length > 0) { alert("‚ùå Errores:\n" + errores.join("\n")); return; }
    document.getElementById('resultado').value = texto;
}

// --- INTERFAZ ---
function toggleTheme() {
    let theme = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem('theme', theme);
    document.getElementById('theme-btn').innerHTML = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
}

function validarCampos() {
    let campos = ['proyecto', 'direccion', 'propiedad', 'area', 'estacionesTexto'];
    let valido = true;
    campos.forEach(id => {
        let el = document.getElementById(id);
        if (!el.value.trim()) { el.classList.add('input-error'); valido = false; }
        else { el.classList.remove('input-error'); }
    });
    return valido;
}

function agregarAlDocumento() {
    const res = document.getElementById('resultado');
    const acu = document.getElementById('acumulado');
    if (!res.value) { alert("‚ö†Ô∏è Genera la minuta primero"); return; }
    let sep = acu.value.trim() ? "\n\n--------------------------------------------\n\n" : "";
    acu.value += sep + res.value;
    document.getElementById('propiedad').value = "";
    document.getElementById('area').value = "";
    document.getElementById('estacionesTexto').value = "";
    res.value = "";
    let lineas = acu.value.split('---').length;
    document.getElementById('progress-bar').style.width = Math.min(lineas * 10, 100) + "%";
    guardarProgreso();
}

function guardarProgreso() {
    const data = { acu: document.getElementById('acumulado').value, proy: document.getElementById('proyecto').value, dir: document.getElementById('direccion').value };
    localStorage.setItem('minuta_sn', JSON.stringify(data));
}

function limpiarAcumulado() {
    if(confirm("¬øBorrar todo?")) {
        document.getElementById('acumulado').value = "";
        document.getElementById('progress-bar').style.width = "0%";
        guardarProgreso();
    }
}

window.onload = function() {
    const saved = localStorage.getItem('minuta_sn');
    if (saved) {
        const d = JSON.parse(saved);
        document.getElementById('acumulado').value = d.acu || "";
        document.getElementById('proyecto').value = d.proy || "";
        document.getElementById('direccion').value = d.dir || "";
    }
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute("data-theme", theme);
    document.getElementById('theme-btn').innerHTML = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
};

function copiarDocumento() {
    navigator.clipboard.writeText(document.getElementById('acumulado').value).then(() => alert("üìã Copiado"));
}

function exportarWord() {
    const contenido = document.getElementById("acumulado").value;
    if (!contenido) return alert("Vac√≠o");
    const html = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'></head><body><div style='font-family:Times New Roman; font-size:12pt; white-space: pre-wrap;'>${contenido.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div></body></html>`;
    const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url; link.download = "MINUTA_SN.doc";
    link.click();
}
</script>
</body>
</html>
