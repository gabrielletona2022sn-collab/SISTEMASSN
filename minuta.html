<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Generador de Minutas ‚Äî SN PROYECTOS</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f6f8fb;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
  --primary:#2563eb;
  --primary-soft:rgba(37,99,235,.12);
}
[data-theme="dark"]{
  --bg:#0b1220;
  --card:#111827;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --border:#1f2937;
  --primary:#60a5fa;
  --primary-soft:rgba(96,165,250,.15);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Outfit',sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  position:sticky;
  top:0;
  z-index:10;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 28px;
  background:var(--card);
  border-bottom:1px solid var(--border);
}
header h1{
  font-size:20px;
  margin:0;
  font-weight:600;
}
.btn-mode{
  background:var(--primary-soft);
  color:var(--primary);
  border:0;
  padding:8px 14px;
  border-radius:999px;
  font-weight:500;
  cursor:pointer;
}
.container{
  max-width:1100px;
  margin:32px auto;
  padding:0 20px;
}
.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:24px;
}
@media(min-width:900px){
  .grid{grid-template-columns:1fr 1fr;}
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:24px;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
}
.card h2{
  margin:0 0 16px;
  font-size:18px;
  font-weight:600;
}
label{
  font-size:13px;
  font-weight:500;
  color:var(--muted);
}
input,textarea{
  width:100%;
  margin-top:6px;
  margin-bottom:14px;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  font-family:inherit;
  font-size:14px;
}
input:focus,textarea:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 3px var(--primary-soft);
}
textarea{resize:vertical;min-height:140px}
.btn{
  border-radius:12px;
  border:0;
  padding:12px 18px;
  font-weight:600;
  cursor:pointer;
  font-size:14px;
}
.btn-primary{background:var(--primary);color:#fff}
.btn-secondary{background:var(--primary-soft);color:var(--primary)}
.btn-danger{background:#ef4444;color:#fff}
.btn-group{display:flex;gap:12px;flex-wrap:wrap}
#resultado,#acumulado{
  font-family:'Times New Roman',serif;
  background:#fcfcfc;
  color:#111;
}
[data-theme="dark"] #resultado,
[data-theme="dark"] #acumulado{
  background:#0b1220;
  color:#e5e7eb;
}
#progress-container{
  display:none;
  height:6px;
  background:var(--border);
  border-radius:10px;
  overflow:hidden;
  margin-bottom:16px;
}
#progress-bar{
  height:100%;
  width:0%;
  background:var(--primary);
  transition:.4s;
}
.input-error{border-color:#ef4444!important}
footer{
  text-align:center;
  padding:30px;
  color:var(--muted);
  font-size:13px;
}
</style>
</head>

<body>

<header>
  <h1>‚öñÔ∏è SN PROYECTOS ¬∑ LegalTech</h1>
  <button class="btn-mode" id="theme-btn" onclick="toggleTheme()">üåô Modo Oscuro</button>
</header>

<div class="container">
  <div id="progress-container"><div id="progress-bar"></div></div>

  <div class="grid">
    <div class="card">
      <h2>Proyecto</h2>
      <label>Nombre del proyecto</label>
      <input id="proyecto" placeholder="Ej. Condominio Aurora">
      <label>Direcci√≥n</label>
      <input id="direccion" placeholder="Ubicaci√≥n completa">
    </div>

    <div class="card">
      <h2>Propiedad</h2>
      <label>Identificador</label>
      <input id="propiedad" placeholder="Casa 1-2">
      <label>√Årea (m¬≤)</label>
      <input id="area" placeholder="120.50">
    </div>

    <div class="card">
      <h2>Estaciones</h2>
      <label>Datos desde Excel</label>
      <textarea id="estacionesTexto" placeholder="Pegue aqu√≠ las filas copiadas desde Excel"></textarea>
      <button class="btn btn-primary" onclick="generar()">Generar minuta</button>
    </div>

    <div class="card">
      <h2>Resultado</h2>
      <textarea id="resultado" readonly placeholder="Texto generado autom√°ticamente..."></textarea>
      <button class="btn btn-secondary" onclick="agregarAlDocumento()">Agregar al documento</button>
    </div>
  </div>

  <div class="card" style="margin-top:32px;">
    <h2>Documento acumulado</h2>
    <textarea id="acumulado" readonly placeholder="Aqu√≠ se construye el documento final..."></textarea>
    <div class="btn-group" style="margin-top:16px;">
      <button class="btn btn-secondary" onclick="copiarDocumento()">Copiar</button>
      <button class="btn btn-primary" onclick="exportarWord()">Descargar Word</button>
      <button class="btn btn-danger" onclick="limpiarAcumulado()">Limpiar</button>
    </div>
  </div>
</div>

<footer>SN PROYECTOS ¬∑ Plataforma LegalTech</footer>

<script>
/* ================= MOTOR ORIGINAL (SIN CAMBIOS) ================= */

function numeroALetras(num){
  if(num===''||num===null||num===undefined)return'';
  let str=num.toString().trim();
  if(str.includes('.')){
    let p=str.split('.');
    return numeroALetras(p[0])+' punto '+numeroALetras(p[1]);
  }
  const u=['cero','uno','dos','tres','cuatro','cinco','seis','siete','ocho','nueve'];
  const e=['diez','once','doce','trece','catorce','quince'];
  const d=['','diez','veinte','treinta','cuarenta','cincuenta','sesenta','setenta','ochenta','noventa'];
  const c=['','ciento','doscientos','trescientos','cuatrocientos','quinientos','seiscientos','setecientos','ochocientos','novecientos'];
  let n=parseInt(str);
  if(isNaN(n))return'';
  if(n<10)return u[n];
  if(n>=10&&n<=15)return e[n-10];
  if(n<20)return'dieci'+u[n-10];
  if(n===20)return'veinte';
  if(n<30)return'veinti'+u[n-20];
  if(n<100){let D=Math.floor(n/10),U=n%10;return d[D]+(U?' y '+u[U]:'');}
  if(n===100)return'cien';
  if(n<1000){let C=Math.floor(n/100),R=n%100;return c[C]+(R?' '+numeroALetras(R):'');}
  if(n<2000)return'mil'+(n%1000?' '+numeroALetras(n%1000):'');
  if(n<1000000){let M=Math.floor(n/1000),R=n%1000;return numeroALetras(M)+' mil'+(R?' '+numeroALetras(R):'');}
  return n.toString();
}

function convertirTexto(t){
  if(!t)return'';
  return t.replace(/\d+(?:-\d+)?(?:\.\d+)?/g,m=>{
    if(m.includes('-')){
      let p=m.split('-');
      return numeroALetras(p[0])+' guion '+numeroALetras(p[1])+' ('+m+')';
    }
    return numeroALetras(m)+' ('+m+')';
  });
}

function validarCampos(){
  let c=['proyecto','direccion','propiedad','area','estacionesTexto'],v=true;
  c.forEach(id=>{
    let e=document.getElementById(id);
    if(!e.value.trim()){e.classList.add('input-error');v=false;}
    else e.classList.remove('input-error');
  });
  return v;
}

function generar(){
  if(!validarCampos())return;
  let t=`${convertirTexto(propiedad.value).toUpperCase()}, ${convertirTexto(proyecto.value).toUpperCase()} (QUE SI FORMAR√Å FINCA FILIAL) Finca nueva de naturaleza urbana, ubicada en ${convertirTexto(direccion.value)}, con un √°rea total de ${numeroALetras(area.value)} (${area.value}) metros cuadrados, y con las siguientes estaciones, medidas y colindancias:\n`;
  let l=estacionesTexto.value.trim().split(/\n+/),err=[];
  l.forEach((x,i)=>{
    let p=x.split(/\t+/);
    if(p.length<5){err.push(`L√≠nea ${i+1}: faltan columnas`);return;}
    let est=p[0],po=p[1],dato=p[2],extra=p[3],col=convertirTexto(p.slice(4).join(' '));
    let r=/(\d+)\s*¬∞\s*(\d+)\s*'\s*(\d+)/;
    t+=`\nDe la estaci√≥n ${numeroALetras(est)} (${est}) al punto observado ${numeroALetras(po)} (${po}): `;
    try{
      let g=dato.match(r);
      if(!g)throw'';
      t+=`Con un azimut de ${numeroALetras(g[1])} grados (${g[1]}¬∞), ${numeroALetras(g[2])} minutos (${g[2]}'), ${numeroALetras(g[3])} segundos (${g[3]}"), una distancia recta de ${numeroALetras(extra)} (${extra}) metros, colindando con ${col}; `;
    }catch{err.push(`L√≠nea ${i+1}: error de formato`);}
  });
  if(err.length){alert(err.join('\n'));return;}
  resultado.value=t;
}

function agregarAlDocumento(){
  if(!resultado.value)return alert('Genera la minuta primero');
  acumulado.value+=(acumulado.value?'\n\n---------------------\n\n':'')+resultado.value;
  resultado.value='';propiedad.value='';area.value='';estacionesTexto.value='';
  progress-container.style.display='block';
}

function copiarDocumento(){
  navigator.clipboard.writeText(acumulado.value).then(()=>alert('Copiado'));
}

function limpiarAcumulado(){
  if(confirm('¬øBorrar todo?'))acumulado.value='';
}

function exportarWord(){
  if(!acumulado.value)return alert('Documento vac√≠o');
  const html=`<html><body><pre>${acumulado.value.replace(/</g,'&lt;')}</pre></body></html>`;
  const b=new Blob(['\ufeff',html],{type:'application/msword'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(b);
  a.download='MINUTA_SN_PROYECTOS.doc';
  a.click();
}

function toggleTheme(){
  let t=document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme',t);
  localStorage.setItem('theme',t);
  theme-btn.innerHTML=t==='dark'?'‚òÄÔ∏è Modo Claro':'üåô Modo Oscuro';
}

window.onload=()=>{
  let t=localStorage.getItem('theme')||'light';
  document.documentElement.setAttribute('data-theme',t);
  theme-btn.innerHTML=t==='dark'?'‚òÄÔ∏è Modo Claro':'üåô Modo Oscuro';
};
</script>
</body>
</html>
